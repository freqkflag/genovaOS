Decision: Option A — Standalone “Overseer” Control Plane

Below is the implementation-grade spec to start building Overseer as a free-standing product (not an OS). This is a practical architecture you can actually ship in phases.

⸻

1) Product Definition

1.1 One-sentence

Overseer is an OS-agnostic homelab control plane that unifies Docker/Compose, Traefik ingress, Cloudflare DNS/Tunnels/Access, and Proxmox into a single secure UI + API with GitOps and automation.

1.2 Primary outcomes
	•	Deploy an app to app.yourdomain.tld in minutes with:
	•	DNS record
	•	TLS
	•	reverse proxy route
	•	optional auth gate
	•	monitoring + backup policy attached

⸻

2) System Architecture

2.1 Components (minimum viable)
	1.	Overseer Core (API + UI)
	2.	Overseer Agent (runs on nodes)
	3.	Provider Integrations
	•	Docker Engine / Compose
	•	Traefik (file provider + labels)
	•	Cloudflare (DNS + Tunnel + Access)
	•	Proxmox (API)

2.2 High-level flow
	•	Core stores desired state (apps, routes, policies)
	•	Agents execute changes locally (deploy compose, write traefik dynamic config, run backups)
	•	Core validates and shows status (health, logs, alerts)

⸻

3) Core Features (MVP → v1)

3.1 MVP (Phase 1: “Deploy & Route”)

Must ship
	•	Node inventory: register agents, show online/offline, versions
	•	App deploy: deploy Compose stacks to selected node(s)
	•	Domain + TLS: create DNS record in Cloudflare + configure Traefik route
	•	App catalog: at least 10 curated templates (e.g., Uptime Kuma, Dashy, Wiki.js, Gitea, Postgres, Redis, MinIO, Paperless, Vaultwarden, Nextcloud)
	•	Secrets: store encrypted env vars and inject into stacks
	•	Logs: basic view (agent logs + container logs)
	•	Rollback: last-known-good stack definition reapply

Nice-to-have (still Phase 1 if easy)
	•	Health checks: container health + endpoint check
	•	Auto-update policy: watchtower-style or pinned tags with manual approve

⸻

3.2 v1 (Phase 2: “Secure Remote + Observe”)
	•	Auth: OIDC integration (Authelia/Keycloak) for Overseer UI
	•	Per-app access policy:
	•	public / private / SSO-protected
	•	Cloudflare Tunnel orchestration
	•	Monitoring bundle:
	•	node metrics + container metrics
	•	Uptime checks
	•	alert rules (email/webhook)
	•	Backup policies:
	•	volume backups (restic)
	•	rclone offsite

⸻

3.3 v1.5+ (Phase 3: “GitOps & Proxmox”)
	•	GitOps repo sync:
	•	app definitions in YAML
	•	PR-based changes + approvals
	•	Proxmox integration:
	•	list/start/stop VMs + LXCs
	•	snapshots
	•	node status
	•	Plugin SDK
	•	Policy-as-code (guardrails)

⸻

4) Requirements

4.1 Non-functional
	•	Security first
	•	TLS required
	•	least-privilege tokens
	•	audit log for admin actions
	•	Portability
	•	Core runs in Docker
	•	Agent runs as systemd service or container
	•	Reliability
	•	Core is stateless; data in Postgres
	•	agents can operate with cached desired state during brief outages
	•	Performance
	•	UI responds <2s on LAN
	•	background jobs via queue

⸻

5) Data Model (Core)

Entities
	•	User
	•	Node
	•	App
	•	Stack (compose content + version)
	•	DomainRoute (hostname → service/port)
	•	Secret
	•	Policy (auth, backups, updates, monitoring)
	•	Job (task queue record)
	•	AuditEvent

⸻

6) API Surface (Core)

Required endpoints (examples)
	•	POST /api/nodes/register
	•	GET /api/nodes
	•	POST /api/apps
	•	POST /api/apps/{id}/deploy
	•	POST /api/apps/{id}/rollback
	•	POST /api/routes
	•	POST /api/integrations/cloudflare/test
	•	POST /api/jobs/{id}/retry
	•	GET /api/audit

⸻

7) Agent Responsibilities

Agent capabilities (minimum)
	•	Deploy/stop/update compose stacks
	•	Stream container logs
	•	Write Traefik dynamic config snippets (or apply labels strategy)
	•	Run backup jobs (restic, rclone)
	•	Collect metrics and send heartbeat

Agent security
	•	Mutual TLS or signed tokens
	•	Node-scoped permissions
	•	No plaintext secrets at rest; decrypt on demand

⸻

8) Networking Strategy

Recommended default
	•	Traefik as the standard ingress
	•	File provider generated by Overseer (clean + explicit)
	•	Optional label-based mode for advanced users

Remote access
	•	Cloudflare Tunnel support (first-class in Phase 2)
	•	Optional Tailscale/Headscale integration later

⸻

9) Packaging & Install

Core
	•	Docker Compose installer:
	•	overseer-core (api+ui)
	•	postgres
	•	redis (queue)
	•	optional minio (artifact storage)

Agent
	•	Single binary + systemd unit (preferred)
	•	Or container with host Docker socket mount

⸻

10) UX Specification (MVP Screens)
	1.	Overview
	•	nodes online/offline
	•	alerts
	•	recent deploys
	2.	Nodes
	•	agent version, resources, docker status
	3.	Apps
	•	list + status + actions (deploy/stop/rollback/logs)
	4.	App Catalog
	•	templates + one-click deploy wizard
	5.	Routes/Domains
	•	hostname, target, TLS, auth mode
	6.	Secrets
	•	scoped secrets, per-app injection
	7.	Jobs
	•	running/failed, retry, logs
	8.	Audit Log

⸻

11) Acceptance Criteria (MVP)
	1.	User can register a node agent and see heartbeat within 10 seconds.
	2.	User can deploy a catalog app to a node using a wizard.
	3.	System creates DNS record in Cloudflare for the chosen hostname.
	4.	Traefik begins routing HTTPS to the app without manual edits.
	5.	App is reachable at https://<hostname> with valid TLS.
	6.	User can view logs and redeploy/rollback from UI.
	7.	All actions appear in an audit log.

⸻

12) Tech Stack Recommendation (practical + fast)

Core
	•	Backend: Node.js (NestJS) or Go (Gin/Fiber)
	•	Frontend: React + Vite
	•	DB: Postgres
	•	Queue: Redis + BullMQ (Node) or Asynq (Go)
	•	Auth: OIDC (Auth.js / or backend OIDC middleware)

Agent
	•	Go is ideal (single static binary, easy systemd)
	•	Uses Docker Engine API + local exec for compose

⸻

13) Repo Layout (suggested)

overseer/
  core/
    api/
    web/
    migrations/
  agent/
  packages/
    sdk/
    types/
  deploy/
    docker-compose.yml
    traefik/
  docs/


⸻

14) Roadmap (Build Order)

Phase 1 (MVP)
	•	Core skeleton + DB
	•	Agent registration + heartbeat
	•	Docker deploy via compose
	•	Traefik route generation
	•	Cloudflare DNS integration
	•	App catalog templates
	•	Logs + rollback
	•	Audit events

Phase 2
	•	OIDC auth
	•	Cloudflare Tunnel orchestration
	•	Monitoring bundle
	•	Backups (restic + rclone)

Phase 3
	•	GitOps sync + approvals
	•	Proxmox integration
	•	Plugin SDK

⸻

15) Decisions You’ve Now Locked In (Option A)
	•	Not an OS distribution
	•	Installable anywhere (Ubuntu/Proxmox nodes included)
	•	Agent-based execution
	•	Traefik + Cloudflare are first-class citizens
	•	GitOps and Proxmox come after MVP deploy+route

⸻

